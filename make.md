# プロジェクトビルドパイプライン

このコマンドは以下の処理を順番に実行します：

1. **デッドコード検出** - 未使用コードの検出
2. **フォーマット** - コードフォーマットを適用
3. **リント** - コード品質チェック（import順序整理含む）
4. **タイプチェック** - TypeScript型チェック
5. **テスト** - 全テストの実行
6. **ビルド** - プロダクションビルド

## 実行

```bash
# パイプライン実行（エラー時即座に停止・実行時間計測）
time (bun run knip && bun run format && bun run lint && bun run typecheck && bun test && bun run build)
```

各ステップでエラーが発生した場合は`&&`演算子により即座に処理を停止し、エラー内容を報告します。

## 処理順序の理由

1. **knip**: 最初に実行することで、未使用コードがある場合は早期に検出し、後続の処理時間を削減
2. **format**: コードスタイルを統一してから品質チェックを実行
3. **lint**: フォーマット済みのコードに対して品質チェック（`biome check`でimport順序も整理）
4. **typecheck**: 型の整合性を確認
5. **test**: コードが正しく動作することを確認（全テスト実行）
6. **build**: すべてのチェックをパスしたコードをビルド

## テスト失敗時の対応

テストが失敗した場合、MAKEコマンドは以下の手順でテストエラーを修正します：

1. **失敗テストの詳細確認**: 失敗したテストケースと期待値vs実際値を特定
2. **根本原因分析**: テストロジックまたは実装コードの問題を分析
3. **修正実装**: テストが正しく動作するよう、必要に応じて以下を修正：
   - テストデータ（座標、期待値など）
   - テストロジック
   - 実装コード（バグがある場合）
4. **修正検証**: 修正後にテストを再実行し、すべてのテストが通ることを確認
5. **リグレッション確認**: 他のテストに影響がないことを確認

### テスト修正の原則

- **実装の正当性を維持**: バグでない限り、実装コードは変更せずテストを修正
- **テストの意図を保持**: テストが検証すべき仕様を正確に反映
- **エッジケースの適切な処理**: 境界条件やエラーケースを正しくテスト
- **型安全性の確保**: TypeScriptの型チェックに準拠

## エラー処理ガイドライン

### 型エラー
- `any`型の使用を避け、適切な型定義を追加
- 不足している型インポートを追加
- 型の互換性を確保

### リントエラー
- コードフォーマットの自動適用
- import順序の自動整理
- 未使用変数・関数の削除

### テストエラー
- 座標計算の修正
- 期待値の調整
- モックデータの更新
- テストロジックの見直し

このパイプラインにより、コード品質とテストの信頼性を継続的に維持します。