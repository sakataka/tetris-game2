# ゲーム内容

Web上で実行できるテトリスを作成する。

- 美しいUI
- 1画面に収まる
- 言語選択（日本語、英語）

# プロジェクト概要

このプロジェクトは、モダンなWebテクノロジーを使用したテトリスゲームです。React 19とTypeScriptで構築され、美しいUI、多言語対応（日本語・英語）、レスポンシブデザインを特徴としています。

## 主な機能

- 完全なテトリスゲーム体験（移動、回転、ライン消去、スコアリング）
- リアルタイムゲームループ
- キーボード操作（矢印キー、スペース、P）
- 次のピース表示
- レベルアップシステム
- ゲーム一時停止・再開機能
- 言語切り替え（日本語/英語）

## アーキテクチャパターン

### 状態管理

- **Zustand**: 軽量でシンプルな状態管理ライブラリを使用
- 単一のゲームストア（gameStore.ts）でゲーム状態を集中管理
- イミュータブルな状態更新パターン

### コンポーネント設計

- **関数型コンポーネント**: React Hooksを活用したモダンなコンポーネント設計
- **コンポーネント分離**: UI要素を独立したコンポーネントに分割
  - Game.tsx: メインゲームコンテナ
  - Board.tsx: ゲームボード表示
  - ScoreBoard.tsx: スコア・レベル表示
  - Controls.tsx: 操作説明
  - NextPiece.tsx: 次のピース表示
  - GameOverlay.tsx: ゲームオーバー・一時停止画面

### ゲームロジック

- **純粋関数**: サイドエフェクトのないゲームロジック
- **テスト駆動開発**: ゲームロジックに包括的なテスト
- **分離された関心事**: ゲームロジック（game/）とUI（components/）の分離

### カスタムHooks

- **useGameLoop**: ゲームの自動進行を管理
- **useKeyboardControls**: react-hotkeys-hookを使用したキーボード入力の宣言的な処理

## アニメーションシステム

- **Framer Motion**: 全アニメーション効果のライブラリ
- **ピース落下**: 新しいピースの出現時のスムーズな落下アニメーション
- **ピース回転**: 回転時の360度回転エフェクトとキーベースのアニメーション
- **ピース配置**: 配置時のスケールアニメーション（縮小→拡大）
- **ライン消去**: フラッシュエフェクト（点滅・スケール変化・グロー効果）
- **スコア更新**: スコア、ライン数、レベルの更新時のスプリングアニメーション
- **UI遷移**: ゲームオーバー・一時停止画面のフェードイン/アウト、モーダルのスプリング効果

## メインエントリーポイント

メインエントリーポイントは以下の通りです：

- **index.html**: HTMLエントリーポイント
- **src/main.tsx**: Reactアプリケーションの起点
- **src/App.tsx**: アプリケーションのルートコンポーネント
- **src/components/Game.tsx**: ゲームのメインコンポーネント

## フォルダ構造

```
src/
├── components/          # UIコンポーネント
├── game/               # ゲームロジック（純粋関数）
├── hooks/              # カスタムHooks
├── i18n/               # 国際化設定
├── locales/            # 言語ファイル
├── store/              # 状態管理（Zustand）
├── test/               # テスト設定
├── types/              # TypeScript型定義
└── utils/              # ユーティリティ関数
```

## データモデル

### 主要な型定義（types/game.ts）

- **GameState**: ゲーム全体の状態（ボード、現在のピース、スコアなど）
- **Tetromino**: テトリスピースの定義（型、位置、回転、形状）
- **Position**: X、Y座標
- **TetrominoType**: 7種類のテトリスピース（I、O、T、S、Z、J、L）

### ゲーム状態

- board: 20×10のゲームボード
- currentPiece: 現在落下中のピース
- nextPiece: 次に出現するピース
- score/lines/level: ゲーム進行状況
- isGameOver/isPaused: ゲーム状態フラグ

## エラーハンドリング

- **TypeScript**: 型安全性による実行時エラーの予防
- **条件チェック**: ゲーム状態の検証（ゲームオーバー、一時停止時の操作無効化）
- **バリデーション**: ピース配置の有効性チェック
- **Graceful Degradation**: 不正な状態でもアプリケーションクラッシュを回避

## 認証

このゲームはクライアントサイドのみで動作するため、認証機能は実装されていません。将来的にハイスコア保存などの機能を追加する際に検討される可能性があります。

## データベース

現在、データベースは使用されていません。ゲーム状態はメモリ内のみで管理され、ページリロード時にリセットされます。

# 開発方針

- **シンプル**: できるだけモダンな機能を利用し、シンプルでメンテナンスしやすく
- **テストファースト**: テスト駆動開発
- **技術選択**: 下記以外(利用フレームワーク・ツール)のフレームワーク・ツールが必要になった場合は、確認すること‼️
- **TODO 駆動開発**: 大がかりな対応をする際は、ドキュメントを作成する。ドキュメントにはフェーズとフェーズ配下のタスクに分けて記載する。フェーズを順番に実行する。1つのフェーズが完了したらドキュメントを更新し、完了したフェーズ・タスクをチェックを入れる。
- **UIリテラルはソースに埋め込まない**: 日本語、英語のリソースファイル対応

# 利用フレームワーク・ツール

## フロントエンドフレームワーク

- React: 19.1.0
- @types/react: 19.1.8
- @types/react-dom: 19.1.6

## ビルドツール・開発環境

- Vite: 6.3.5
- TypeScript: 5.8.3 (ES2024ターゲット)
- Node.js: 24.2
- pnpm: 10.12.1

## スタイリング・UI

- Tailwind CSS: 4.1.10
- shadcn/ui: 2.7.0
- Framer Motion: 12.18.1 (アニメーション)

## 状態管理・データ処理

- Zustand: 5.0.5 (状態管理)

## スキーマ宣言・データ検証

- Zod: 4 (将来のハイスコア保存機能・設定データ永続化での使用予定)

## キーボード入力ハンドリング

- react-hotkeys-hook: 5.1.0 (宣言的なキーボード入力管理)

## 国際化

- i18next: 25.2.1

## コード品質・リンティング

- Biome: 2.0.2 (リンティング・フォーマッティング)
- Lefthook: 1.11.14 (Gitフック管理)

## テスト

- Vitest: 3.2.4 (テストフレームワーク)

## 最適化・バンドル

- knip: 5.61.2 (デッドコード検出)

## ソース管理

- git: 2.50
- gh: 2.74.2

## デプロイメント

- Vercel

## CI/CDワークフロー

- GitHub Actions

# 現在の実装アーキテクチャ

## アプリケーション構成

### エントリーポイント設計

アプリケーションは、React 19の標準的なエントリーポイント構成に従っています。メインエントリーではReact StrictModeを使用してアプリケーションを初期化し、国際化設定の自動読み込みとグローバルCSSの適用を行っています。アプリケーションのルートコンポーネントは最小限の設計で、メインゲームコンポーネント一つのみを配置するシンプルな構成となっています。

### 型安全な設計

TypeScriptの型システムを活用して、ゲーム全体の型安全性を確保しています。テトリスの7種類のピース型（I、O、T、S、Z、J、L）をユニオン型で定義し、ピースの位置、回転状態、形状を包含する包括的な型システムを構築しています。ゲーム状態は、ボード、現在・次のピース、スコア、レベル、ゲーム状態フラグ、アニメーション用の状態を含む中央集権的な状態管理となっています。

### 状態管理アーキテクチャ

Zustandによる軽量で直感的な状態管理を採用しています。ゲーム操作は純粋関数として実装され、状態更新はImmutableパターンに従って行われます。状態ストアは、ゲーム状態の管理とゲーム操作メソッド（移動、回転、ドロップ、一時停止、リセット）を統合して提供し、アニメーション状態の管理も含んでいます。

### ゲームロジック実装

ゲームロジックは関数型プログラミングの原則に従い、副作用のない純粋関数として実装されています。メインゲームロジックでは、初期状態生成、ピース移動・回転・ドロップ処理、ライン消去、スコア計算などの核となる機能を提供しています。テトリスピースの定義では、7種類のピース形状をデータ構造として管理し、90度時計回り回転アルゴリズムを実装しています。ボード操作では、20×10のゲームボード管理、ピース配置の有効性検証、完成ライン検出・消去機能を提供しています。

### カスタムHooks設計

ゲームループ管理には、requestAnimationFrameを使用したスムーズなフレーム制御を実装し、レベルに応じた落下速度調整、一時停止・ゲームオーバー時の適切な停止処理を行っています。キーボード制御では、react-hotkeys-hookライブラリを活用した宣言的なキー入力管理を採用し、矢印キーによる移動・回転、スペースキーによるハードドロップ、Pキーによる一時停止（デバウンス機能付き）、Enterキーによるゲームリセット機能を提供しています。

### UIコンポーネント構成

メインゲームコンテナでは、カスタムHooksを統合してゲームループとキーボード制御を管理し、CSS Gridによる完全なレスポンシブレイアウトを実装しています。デスクトップ向けのグリッドレイアウトとモバイル向けの縦スタックレイアウトを提供し、各UIコンポーネント（言語選択、スコアボード、ボード、次のピース、操作説明、オーバーレイ）を適切に配置しています。

ゲームボードコンポーネントでは、React.memoによる最適化を実装し、200個のセル（20×10グリッド）を効率的に管理しています。30×30ピクセルの固定サイズセルを採用し、Framer Motionによる豊富なアニメーション効果（ピース落下、配置、ライン消去）を統合しています。

### アニメーションシステム

Framer Motionライブラリを活用した包括的なアニメーション設計を採用しています。新しいピース出現時のスプリングアニメーション、ピース回転時の360度回転エフェクト、ライン消去時のフラッシュ・パルス・グロー効果、スコア更新時のスプリングアニメーション、UI遷移のフェード・モーダル効果など、ゲーム体験を向上させる多様なアニメーションを実装しています。

### 国際化対応

i18nextライブラリによる多言語対応システムを構築しています。デフォルト言語は日本語、フォールバック言語は英語に設定し、ゲーム用語、操作方法、UI文言を含む構造化された言語リソースファイルを管理しています。実行時の言語切り替え機能を提供し、UIリテラルのソースコード埋め込みを完全に排除しています。

### スタイリングシステム

Tailwind CSS 4.1の最新記法を採用し、カスタムテトリス色（各ピース専用色）をテーマシステムで定義しています。shadcn/uiコンポーネントとの統合のためのCSS変数設定、事前生成されるクラスの最適化、全画面固定レイアウトの実装を行っています。モバイルファーストのレスポンシブデザインアプローチを採用し、デバイス別の最適化を図っています。

## 品質保証と最適化

### テスト戦略

Vitest + TypeScriptによるテスト駆動開発（TDD）アプローチを採用しています。ボードロジック、ゲームロジック、テトリスピース操作に対する包括的なテストを実装し、純粋関数による実装により高いテスト可能性を確保しています。

### パフォーマンス最適化

React.memoによる不要な再レンダリング防止、アニメーション状態の定期的クリア、requestAnimationFrameによるスムーズなゲームループ、Zustandでのimmutable更新パターン、必要時のみのリソース読み込みなど、多層的なパフォーマンス最適化を実装しています。

### セキュリティ配慮

Reactの自動エスケープによるXSS対策、インラインスタイル・スクリプト回避によるCSP対応、TypeScriptによる型安全性確保、定期的な依存関係管理により、セキュリティリスクを最小化しています。

この実装は、現代的なWeb開発のベストプラクティスに基づき、保守性、拡張性、パフォーマンス、ユーザビリティを総合的に考慮した設計となっています。

